# GitLab Pipeline Monitor

一个用于监控 GitLab Pipeline 状态的 Chrome 插件，支持多项目监控、实时通知和状态持久化。

## ✨ 主要功能

### 核心功能
- 📊 **多项目监控**: 同时监控多个 GitLab 项目的 Pipeline 状态
- 🔄 **实时刷新**: 支持手动刷新和自动定时刷新（1-30分钟间隔）
- 🔔 **桌面通知**: Pipeline 失败或完成时自动发送通知
- 📱 **状态徽章**: 插件图标显示失败或运行中的 Pipeline 数量
- 💾 **状态持久化**: 切换页面时保持插件状态，避免重新加载

### 界面功能
- 🎨 **现代化界面**: 基于 Tailwind CSS 的美观界面
- 🔍 **搜索过滤**: 支持按分支名、提交信息、用户名搜索
- 📋 **状态过滤**: 按 Pipeline 状态过滤显示
- 🔗 **快速跳转**: 失败的 Pipeline 可直接点击跳转到 GitLab
- ❓ **内置帮助**: 提供 Access Token 创建指导和项目配置帮助

### 高级功能
- ⏰ **自动刷新**: 可配置的后台自动检查和通知
- 🎯 **智能通知**: 只在状态变化或新 Pipeline 失败时通知
- 📈 **多状态支持**: 显示成功、失败、运行中、等待中、已取消状态
- 🔄 **优雅降级**: 网络错误时的友好错误提示

## 📦 安装使用

### 1. 下载插件
```bash
git clone https://github.com/leylatop/gitlab-pipeline-monitor.git
cd gitlab-pipeline-monitor
```

### 2. 安装到 Chrome
1. 打开 Chrome 浏览器
2. 地址栏输入 `chrome://extensions/`
3. 开启右上角的「开发者模式」
4. 点击「加载已解压的扩展程序」
5. 选择插件目录

### 3. 配置插件

#### 第一步：基础配置
1. 点击插件图标打开界面
2. 点击右上角齿轮图标进入设置
3. 填写以下信息：
   - **GitLab URL**: 您的 GitLab 实例地址（如：`https://gitlab.com`）
   - **Access Token**: 您的个人访问令牌

#### 第二步：获取 Access Token
插件提供了获取 Access Token 的完整指导：

1. 在设置页面点击 Access Token 旁边的帮助按钮 ❓
2. 或点击「创建 Token」链接直接跳转到 GitLab
3. 按照提示创建具有以下权限的 Token：
   - `read_api` - 读取 API 权限
   - `read_repository` - 读取仓库权限

#### 第三步：添加监控项目
1. 在设置页面的「监控项目」部分点击「添加项目」
2. 输入项目的 Project ID
3. 点击「确认添加」
4. 可添加多个项目进行监控

#### 第四步：配置自动刷新（可选）
- 勾选「启用自动刷新」
- 选择刷新间隔（1-30分钟）
- 插件将在后台定期检查 Pipeline 状态

## 🎯 功能详解

### 项目管理
- **多项目支持**: 可以同时监控多个 GitLab 项目
- **项目切换**: 通过下拉菜单快速切换查看不同项目
- **动态添加**: 运行时可以添加或移除监控项目
- **项目验证**: 添加项目时会验证访问权限

### 状态显示
| 状态 | 显示 | 说明 |
|------|------|------|
| ✅ 成功 | 绿色边框 | Pipeline 执行成功 |
| ❌ 失败 | 红色边框 | Pipeline 执行失败，可点击跳转 |
| 🔄 运行中 | 蓝色边框 | Pipeline 正在执行 |
| ⏳ 等待中 | 黄色边框 | Pipeline 等待执行 |
| ⏹️ 已取消 | 灰色边框 | Pipeline 被用户取消 |

### 通知机制
- **失败通知**: 新 Pipeline 失败时立即通知
- **完成通知**: 运行中的 Pipeline 完成时通知
- **状态变化**: Pipeline 状态发生变化时通知
- **避免重复**: 相同状态不会重复通知

### 状态持久化
- **跨页面保持**: 切换浏览器标签页时保持插件状态
- **搜索保持**: 搜索条件和过滤设置会被保存
- **项目记忆**: 记住当前选择的项目
- **设置同步**: 设置更改实时同步到后台

## 🔧 配置说明

### GitLab URL 格式
- 公共 GitLab: `https://gitlab.com`
- 私有实例: `https://gitlab.company.com`
- 带端口: `https://gitlab.company.com:8080`

### Project ID 获取方法
1. 登录 GitLab 并进入项目设置页面
2. 在左侧菜单选择 "General"
3. 在 "Project ID" 字段中找到 Project ID

### Access Token 权限
插件需要以下最小权限：
- `read_api`: 读取 API 数据
- `read_repository`: 读取仓库信息（用于获取提交详情）

## 📋 使用技巧

### 快捷键
- `Ctrl/Cmd + R`: 刷新 Pipeline 列表
- `Esc`: 关闭设置面板或取消操作

### 搜索技巧
- 支持搜索分支名：`feature/login`
- 支持搜索提交信息：`fix bug`
- 支持搜索用户名：`张三`
- 支持组合搜索：输入多个关键词

### 过滤技巧
- 使用状态过滤器快速查看特定状态的 Pipeline
- 结合搜索和过滤缩小范围
- 清空搜索框显示所有结果

## 🔒 隐私和安全

### 数据存储
- 所有配置信息存储在本地浏览器中
- 不会上传任何数据到第三方服务器
- Access Token 使用浏览器安全存储

### 权限需求
插件请求的权限及用途：
- `storage`: 保存配置信息和状态
- `alarms`: 实现自动刷新功能
- `notifications`: 发送桌面通知
- `tabs`: 在失败时打开 GitLab 页面

## 🐛 故障排除

### 常见问题

#### 1. 无法加载 Pipeline 数据
**可能原因**：
- GitLab URL 不正确
- Access Token 无效或权限不足
- 网络连接问题
- Project ID 不存在或无访问权限

**解决方案**：
1. 检查 GitLab URL 是否能正常访问
2. 重新生成 Access Token 并确保权限正确
3. 验证 Project ID 是否正确
4. 检查网络连接

#### 2. 通知不工作
**可能原因**：
- 浏览器通知权限被禁用
- 自动刷新未启用
- 后台脚本出错

**解决方案**：
1. 检查浏览器通知权限设置
2. 启用自动刷新功能
3. 重新安装插件

#### 3. 项目添加失败
**可能原因**：
- Project ID 格式错误（应为纯数字）
- 无访问权限
- 网络连接问题

**解决方案**：
1. 确认 Project ID 为纯数字格式
2. 检查是否有项目访问权限
3. 尝试手动访问项目 API

#### 4. 界面显示异常
**可能原因**：
- CSS 文件加载失败
- 浏览器兼容性问题

**解决方案**：
1. 刷新插件或重新加载
2. 检查浏览器版本（推荐 Chrome 88+）
3. 清除浏览器缓存

### 调试模式
1. 打开 Chrome 开发者工具 (F12)
2. 切换到 Console 标签
3. 查看错误信息和调试日志
4. 如有问题请提供错误信息

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发环境
1. 克隆项目到本地
2. 在 Chrome 中加载开发版本
3. 修改代码后重新加载插件测试

### 提交规范
- 使用有意义的提交信息
- 遵循现有代码风格
- 添加必要的注释
- 测试新功能的兼容性

## 📄 许可证

本项目基于 MIT 许可证开源，详见 [LICENSE](LICENSE) 文件。

## 📞 支持

如有问题或建议，请：
1. 提交 GitHub Issue
2. 发送邮件至：[leyla_qiao@163.com](mailto:leyla_qiao@163.com)
3. 查看 [QUICK_START.md](QUICK_START.md) 了解更多信息

---

**Happy Coding! 🚀** 